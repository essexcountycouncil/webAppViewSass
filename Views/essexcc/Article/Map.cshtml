@model Tuple<string, string, string>

<!DOCTYPE html>
<html lang="en-GB" class="no-js">
<head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Including CSS files -->
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/custom/css/atMyPages.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/custom/css/atMyPages-js.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/custom/css/Map.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/css/jQuery/jquery.core.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/css/jQuery/jquery.autocomplete.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/css/jQuery/astun/ui.all.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/css/responsive/normalize.css" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/custom/css/responsive.css" />
    <link href="//essex.astuntechnology.com/custom/popups.css" type="text/css" rel="stylesheet" />
    <link href="//essex.astuntechnology.com/custom/responsiveoverrides.css" type="text/css" rel="stylesheet" />
    <link href="//essex.astuntechnology.com/custom/page.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="//essex.astuntechnology.com/custom/css/responsive.css" />

    <!-- Layerinfo plugin CSS files -->
    <link href="//essex.astuntechnology.com/custom/layerinfo/layerinfo.css" type="text/css" rel="stylesheet" />
    <!-- End of Layerinfo plugin CSS files -->
    <script type="text/javascript" src="//essex.astuntechnology.com/js/responsivedesign.js"></script>
    <style>
			#atMap {
				position: relative;
				width: 100%;
				padding: 0;
				/ *border: 1px solid #ccc; */
			}
			#atMyMaps .atPopupFeatureInfo .infoResult {font-family:Arial; font-size: 1em !important; margin:0px !important;}
		#atMyMaps .atPopupFeatureInfo .infoResult p {margin:5px !important;}
		#atMyMaps .atPopupFeatureInfo h3 {font-family: Arial; background-color:#E6024A;}
		div#infoPopup {
			z-index: 1;
			/*display: block;
			max-height: 42%;
			top: 52%;
			right: 5px;
			width: 20%;
			min-width: 10em;
			*/
		}
			div.popupCloser {
				color: rgb(255, 255, 255) !important;
			}

			@@media (max-height: 360px) {
				#atMyMaps #atMap, .atMapBody #atContent { height: 300px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 300px !important; overflow: scroll;}}
			@@media (min-height: 361px) and (max-height: 380px) { #atMyMaps #atMap, .atMapBody #atContent { height: 300px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 300px !important; overflow: scroll;}}

			@@media (min-height: 381px) and (max-height: 400px) { #atMyMaps #atMap, .atMapBody #atContent { height: 320px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 320px !important; overflow: scroll;}}

			@@media (min-height: 401px) and (max-height: 440px) { #atMyMaps #atMap, .atMapBody #atContent { height: 340px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 340px !important; overflow: scroll;}}
			@@media (min-height: 441px) and (max-height: 480px) { #atMyMaps #atMap, .atMapBody #atContent { height: 380px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 380px !important; overflow: scroll;}}
			@@media (min-height: 481px) and (max-height: 520px) { #atMyMaps #atMap, .atMapBody #atContent { height: 420px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 420px !important; overflow: scroll;}}
			@@media (min-height: 521px) and (max-height: 560px) { #atMyMaps #atMap, .atMapBody #atContent { height: 480px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 480px !important; overflow: scroll;}}
			@@media (min-height: 561px) and (max-height: 600px) { #atMyMaps #atMap, .atMapBody #atContent { height: 500px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 500px !important; overflow: scroll;}}
			@@media (min-height: 601px) and (max-height: 640px) { #atMyMaps #atMap, .atMapBody #atContent { height: 540px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 540px !important; overflow: scroll;}}
			@@media (min-height: 641px) and (max-height: 680px) { #atMyMaps #atMap, .atMapBody #atContent { height: 580px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 580px !important; overflow: scroll;}}
			@@media (min-height: 681px) and (max-height: 720px) { #atMyMaps #atMap, .atMapBody #atContent { height: 620px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 620px !important; overflow: scroll;}}
			@@media (min-height: 721px) and (max-height: 760px) { #atMyMaps #atMap, .atMapBody #atContent { height: 660px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 660px !important; overflow: scroll;}}
			@@media (min-height: 761px) and (max-height: 800px) { #atMyMaps #atMap, .atMapBody #atContent { height: 700px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 700px !important; overflow: scroll;}}
			@@media (min-height: 801px) and (max-height: 840px) { #atMyMaps #atMap, .atMapBody #atContent { height: 740px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 740px !important; overflow: scroll;}}
			@@media (min-height: 841px) and (max-height: 880px) { #atMyMaps #atMap, .atMapBody #atContent { height: 780px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 780px !important; overflow: scroll;}}
			@@media (min-height: 881px) and (max-height: 920px) { #atMyMaps #atMap, .atMapBody #atContent { height: 820px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 820px !important; overflow: scroll;}}
			@@media (min-height: 921px) and (max-height: 960px) { #atMyMaps #atMap, .atMapBody #atContent { height: 860px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 860px !important; overflow: scroll;}}
			@@media (min-height: 961px) and (max-height: 1000px) { #atMyMaps #atMap, .atMapBody #atContent { height: 900px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 900px !important; overflow: scroll;}}
			@@media (min-height: 1001px) and (max-height: 1040px) { #atMyMaps #atMap, .atMapBody #atContent { height: 940px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 940px !important; overflow: scroll;}}
			@@media (min-height: 1041px) and (max-height: 1080px) { #atMyMaps #atMap, .atMapBody #atContent { height: 980px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 980px !important; overflow: scroll;}}
			@@media (min-height: 1081px) and (max-height: 1280px) { #atMyMaps #atMap, .atMapBody #atContent { height: 1040px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 1040px !important; overflow: scroll;}}
			@@media (min-height: 1281px) and (max-height: 1480px) { #atMyMaps #atMap, .atMapBody #atContent { height: 1240px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 1240px !important; overflow: scroll;}}
			@@media (min-height: 1481px) and (max-height: 1680px) { #atMyMaps #atMap, .atMapBody #atContent { height: 1440px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 1440px !important; overflow: scroll;}}
			@@media (min-height: 1681px) and (max-height: 1880px) { #atMyMaps #atMap, .atMapBody #atContent { height: 1640px !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel { max-height: 1640px !important; overflow: scroll;}
				}

			.ui-dialog {
				width: auto;
			}

			.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel {
				overflow-x: hidden; overflow-y: scroll;
			}

			.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.map-panel {
				/* width: auto !important; */
			}

			@@media (max-width: 740px) {
				#panels { height: auto !important; }
				div#panels.atPanelInnerWrapper { height: auto !important; }
				#atTextSearch {	width: 79% !important; }
				.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.no-close.ui-draggable {width:90% !important;}
			}

			#atPoweredBy { margin-top: 10px; }

			.ui-widget { font-size: 0.9em !important; }

			#atPanel-mapsourceswitcher, #atPanel-findnearest, #atPanel-takemeto, #atPanel-searchfor, #atPanel-showmapcategories { font-size: 0.6em; }

			div#atPanelToggle, div#atZoomControls {
				position: absolute;
				z-index: 1000;
			}

			div#atPanelToggle {
				left: 11px;
				top: 18px;
				height: 30px;
			}

			div#atZoomControls {
				left: 11px;
				top: 80px;
			}

			div#atZoomControls a, div#atPanelToggle a {
				width: 40px;
				height: 50px;
				display: inline-block;
				font-size: 18px;
				font-weight: bold;
				text-align: center;
				padding: 10px;
				border-radius: 4px;
				box-shadow: none;
				text-decoration: none;
				box-sizing: border-box;
			}

			div#atPanelToggle a {
				background-image: url(menu.png);
				background-size: 18px;
				background-repeat: no-repeat;
				background-position: 50%;
			}

			div#atZoomControls a {
				display: block;
				font-size: 26px;
				line-height: 25px;
				margin-top: 5px;
			}

			a.atJqOpenClose.ui-icon.ui-widget-header.ui-corner-br.ui-corner-tr.ui-icon-carat-1-w {
				visibility: hidden;
			}
			a.atJqOpenClose.ui-icon.ui-widget-header.ui-corner-br.ui-corner-tr.ui-icon-carat-1-e {
				visibility: hidden;
			}
			.atPopupFeatureInfo .contentDisplay h3 {
			background-color: #d00f42 !important;
			}
			div#otherInformation p {
			font-size: 14px;
			margin:2px;
			}
    </style>
    <link type="text/css" href="//essex.astuntechnology.com/custom/css/mycouncil.css" rel="stylesheet" />

    <script type="text/javascript">
        if (!window.astun) { window.astun = {}; }
        if (!window.astun.settings) { window.astun.settings = {}; }
        window.astun.settings.addressSearch = {
            'showRecordsCount': true
        }
        window.astun.settings.mapOptions = {};
        window.astun.settings.mapOptions.showSearchResultsUnderMap = true;
        var responsiveDesign = new astun.ResponsiveDesign(240);
    </script>
    <script type="text/javascript" src="//essex.astuntechnology.com/js/lib/prototype-1.6.0.3.js"></script>
    <script type="text/javascript" src="//essex.astuntechnology.com/FileIncluderJS.aspx?language="></script>
</head>

<body>
    <form name="atMapSpurForm" method="post" action="myhouse.aspx" id="atMapSpurForm" class="astunContainer atJSEnabled">
        <div id="atButtonBar">
            <input type="submit" name="atButtonBar$btnOtherThings" value="Show side panel" id="atButtonBar_btnOtherThings" class="ui-state-default ui-corner-all" />
            @*
            <input type="submit" name="atButtonBar$btnResetPage" value="Reset" id="atButtonBar_btnResetPage" class="ui-state-default ui-corner-all" />
            *@
        </div>
        <div id="atMyMaps" class="atModule atVersion2">
            <div id="atContent" class="atMapContent">
                <div class="atPanelContainer">
                    <div class="atPanelContent" id="atMap" style="padding:0">
                        <div id="atInitialLoader" class="ui-state-default" style=" margin:180px auto auto;width: 75px; background: none repeat scroll 0% 0% rgb(255, 255, 255); z-index: 800; text-align: center; padding: 10px; border-width: 5px; -moz-border-radius: 15px 15px 15px 15px; -moz-box-shadow: 5px 5px 3px rgb(129, 129, 129); display: block;">
                            <img src="//essex.astuntechnology.com/images/stopwatch.gif" id="atMapTimer" style="float:none" alt="stopwatch" />
                            <span>
                                <br><span style="display:block; padding-top:7px">Loading...</span>
                            </span>
                            <div style="clear: both"></div>
                            <div id="atPanelResults" style="display: none; padding: 5px; margin-top: 10px; font-size: 80%" class="ui-state-default ui-corner-all">
                                <h3 style="margin: 5px">Map Information:</h3>
                                <div id="atResults">Results</div>
                            </div>
                        </div>
                    </div>
                </div> <!-- .atPanelContainer -->
            </div> <!-- #atContent -->
        </div> <!-- #atMyMaps -->
    </form>
    <script type="text/javascript">
        Event.observe(window, 'load', function () {
            pageType = $('atMap') ? 'isharemaps.mymaps' : 'isharemaps.simple';
            Astun.JS.IncludeJS(pageType, function () {
                atMyCouncil();
                if ($('atMap')) {
                    loadMap();
                }
                if (astun && astun.customJS && typeof astun.customJS == "function") {
                    astun.customJS();
                }
            });
        });

        function atMyCouncil() {
            if (!window.astun) {
                window.astun = {};
                astun = window.astun;
            }
            if (!astun.settings) {
                astun.settings = {};
            }

            astun.settings.themeName = astun.settings.themeName || 'base';
            astun.settings.popupDelay = astun.settings.popupDelay || 500;

            if (!astun.mypages) astun.mypages = {};
            astun.mypages.eventElement = $('atMapSpurForm');

            if (jQuery('#atMyNearest').length > 0) jQuery('.atPanelContainer').panelsaccordion();

            //My Alerts accordion
            if (jQuery('#atMyAlerts').length > 0) jQuery('#atMyAlertsLocationBased .atPanelContent:first').myalertsaccordion();

            //Address finder
            var addressfinder = new Astun.JS.GetData.AddressFinder(astun.mypages.eventElement, '//essex.astuntechnology.com/GetData.aspx');
            jQuery('#atLocationBar').addresssearch("", "", "", { addressBarSearch: true });

            //On Pagereset button click, delete the cookies first - bug 1932
            jQuery('#atButtonBar_btnResetPage').click(Astun.JS.Common.clearAstunCookies);
        }

        function loadMap() {
            var loader = {};
            if (!window.astun.settings.mapOptions) {
                window.astun.settings.mapOptions = {};
            }
            loader.mapID = 'atMap';

            function isSmallWindow() {
                return jQuery(window).width() < 740;
            }

            function panelShown() {
                var right = jQuery('.atMainJQWrapper').css('right');
                return right == 'auto' || parseInt(right, 10) == 0;
            }

            function dialogOpen() {
                return (jQuery('.ui-dialog.map-panel').children().length > 1)
            }

            // Hide the side panel by default on small screens
            if (isSmallWindow()) {
                jQuery.fn.panelswrapper.defaults.hideInStart = true;
            }

            function openDialog() {
                // If the user has changed map source there will be
                // an additional empty div.atPanelInnerWrapper which
                // we need to remove
                jQuery('.atPanelInnerWrapper:empty').remove();

                // Ensure the dialog is destroyed first, without destroying
                // it the content can be missing if the content has been shown
                // as a side panel before the user resized the window to cause
                // it to be displayed in a dialog
                jQuery('.atPanelInnerWrapper').dialog('destroy');

                var winH = jQuery(window).height();
                var winW = jQuery(window).width();

                // Determine the dimensions of the dialog to suit the window
				var maxHeight = 600;
				var maxWidth = 400;
	            if ('@Model.Item2'.toUpperCase() === 'Null,Null'.toUpperCase()) {
	                maxWidth = 800;
	            }
                var minPadding = 10;
                var height = winH - (2 * minPadding);
                var width = winW - (2 * minPadding);
                height = (height > maxHeight) ? maxHeight : height;
                width = (width > maxWidth) ? maxWidth : width;

                // Position the dialog
                var top = (winH - height) / 2;
                var left = (winW - width) / 2;

                var d = jQuery('.atPanelInnerWrapper').dialog({
                    title: "Menu",
                    appendTo: "#atMyMaps",
                    height: height,
                    width: width,
                    modal: true,
                    resizable: false,
                    draggable: false,
                    dialogClass: "map-panel",
                    open: function () {
                        // Close the dialog if the user clicks on the overlay
                        // which makes it modal
                        jQuery('.ui-widget-overlay').bind('click', function () {
                            closeDialog();
                        })
                    },
                    close: function () {
                        jQuery('.atPanelInnerWrapper')
                            .removeClass('ui-dialog-content')
                            .appendTo(jQuery('.atOuterWpr.noTB'));
                    }
                }).dialog('widget');

                d.css('position', 'fixed').css('top', top + 'px').css('left', left + 'px');
            }

            function closeDialog() {
                jQuery('a.ui-dialog-titlebar-close').click();
            }

            Event.observe($(loader.mapID), 'astun:sourceLoad', function (evt) {

                var panels = [];

	            var allowedPanels = '@Model.Item2';
				if ('@Model.Item2'.toUpperCase() === 'Null,Null'.toUpperCase()) {
		        //    allowedPanels = 0;
				    panels.push(
				        {
				            cssClass: 'atPanelSearch',
				            title: 'Address Search',
				            pluginName: 'addresssearch',
				            pluginData: evt,
				            pluginOpts: { collapseInStart: true }
                        });
				    jQuery.fn.panelswrapper.defaults.hideInStart = true;
	            }

                if (allowedPanels.indexOf('Address') >= 0) {
                    panels.push(
                    {
                        cssClass: 'atPanelSearch',
                        title: 'Address Search',
                        pluginName: 'addresssearch',
                        pluginData: evt,
                        pluginOpts: { collapseInStart: true }
                    });
                }

                if (allowedPanels.indexOf('TakeMeTo') >= 0) {
                    panels.push(
                    {
                        cssClass: 'atTakeMeTo',
                        title: 'Take Me To',
                        pluginName: 'takemeto',
                        pluginData: evt,
                        pluginOpts: { collapseInStart: true }
                    });
                }

                if (allowedPanels.indexOf('Categories') >= 0) {
                    panels.push(
                    {
                        cssClass: 'atShowmapCategories',
                        title: 'Show Map Categories',
                        pluginName: 'showmapcategories',
                        pluginData: evt,
                        pluginOpts: { collapseInStart: true }
                    });
                }

                //Options to pass to the function
                var options = {
                    panelWrapperTopPosition: 1,
                    attachPanelWrapperTo: '#' + loader.mapID
                };

                //Call the function which will start all jQuery plugins having these options
                jqueryFunctions(jQuery, jQuery('#' + loader.mapID), panels, options);

                //On map page toggle the panel wrapper if user click 'other things that may interest you'
                jQuery('#atButtonBar_btnOtherThings').live('click', function () {
                    jQuery('#' + loader.mapID).trigger('togglePanelWrapper');
                    return false;
                });

                // Attempt to ensure the popup is not obscured by base map buttons
                astun.mapWrapper.map.paddingForPopups.right = 120;

                // Remove the PanZoomBar control, we will add a set of plain
                // links which work reliably on all devices
                astun.mapWrapper.map.removeControl(
                    jQuery.grep(astun.mapWrapper.map.controls, function (control, idx) {
                        return control.displayClass == 'olControlPanZoomBar'
                    })[0]
                );

                jQuery('.atJqOpenClose').hide();


                function fixPanelPosition() {
                    // Ensure the vertical positon of the panel is correct
                    jQuery('.atPanelWrapperParent').css('top', Math.round(jQuery('#atMap').offset().top));
                }

                var appendTo = isSmallWindow() ? '.atPanelContent.olMap' : '.olMapViewport';
                // New bolder menu toggle button
                jQuery('<div id="atPanelToggle" class="atPanelToggle"><a href="#" title="Menu">&nbsp;</a></div>').appendTo(appendTo).click(function () {
                    if (isSmallWindow()) {
                        openDialog();
                    } else {
                        fixPanelPosition()
                        // Toggle the panel
                        jQuery('.atJqOpenClose').click();
                    }
                    return false;
                });

                fixPanelPosition();

                jQuery('<div id="atZoomControls" class="atZoomControls"><a href="#zoomin" class="zoomin" title="Zoom in">+</a><a href="#zoomout" class="zoomout" title="Zoom out">-</a></div>').appendTo(appendTo).click(function (e) {
                    if (e.target.hash === '#zoomin') {
                        astun.mapWrapper.map.zoomIn()
                    } else {
                        astun.mapWrapper.map.zoomOut()
                    }
                    return false;
                });

                var mapElm = $('atMap');

                // Close the dialog when a map source is choosen
                jQuery(mapElm).bind('loadMapSource', window, function (evt) {
                    if (dialogOpen()) {
                        closeDialog();
                    }
                });

                // Close dialog when a take me to link is clicked
                jQuery(mapElm).bind('mapMove', window, function (evt) {
                    if (dialogOpen()) {
                        closeDialog();
                    }
                });

                // Close dialog when search for or find nearest results are found
                Event.observe(mapElm, 'astun:resultsReceived', function (evt) {
                    if (evt.memo.html.toLowerCase().indexOf(Astun.lang.common.noResultsFound.toLowerCase()) === -1) {
                        if (dialogOpen()) {
                            closeDialog();
                        }
                    }
                });

                function windowSized() {
                    if (panelShown()/* && isSmallWindow()*/) {
                        // Close it
                        jQuery('.atJqOpenClose').click();
                    }
                }
            });
            //Start the map
            loader.map = new Astun.JS.Map(loader.mapID, { mapSource: '@Model.Item1', layers: '@Model.Item3', view: { easting: 570000, northing: 205000, zoom: 10000 } });

            //Initialize the address finder
            loader.addressFinder = new Astun.JS.GetData.AddressFinder(loader.map.mapElement, loader.map.dataurl);
        }
    </script>
    <script src="//essex.astuntechnology.com/custom/layerinfo/layerinfo.js" type="text/javascript"></script>
</body>
</html>